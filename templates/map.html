<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Яндекс.Карта + Flask</title>
    <style>
        #map {
            width: 100%;
            height: 500px;
            margin: 20px 0;
            border: 1px solid #ccc;
        }
        .search-box {
            margin: 10px 0;
            padding: 8px;
            width: 300px;
        }
        button {
            padding: 8px 15px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <!-- Подключаем API Яндекс.Карт -->
    <script src="https://api-maps.yandex.ru/2.1/?apikey=ваш_api_ключ&lang=ru_RU"></script>
    <script>
        let map, placemark;

        // Инициализация карты
        ymaps.ready(initMap);

        function initMap() {
            map = new ymaps.Map("map", {
                center: [55.751244, 37.618423],  // Москва
                zoom: 10
            });

            // Обработчик клика по карте
            map.events.add('click', function(e) {
                const coords = e.get('coords');

                // Удаляем старую метку
                if (placemark) {
                    map.geoObjects.remove(placemark);
                }

                // Добавляем новую метку
                placemark = new ymaps.Placemark(coords, {
                    hintContent: 'Вы кликнули здесь!',
                    balloonContent: `Координаты: ${coords}`
                });
                map.geoObjects.add(placemark);

                console.log("Координаты:", coords);
            });
        }

        // Поиск адреса
        function searchAddress() {
            const address = document.getElementById('address').value;
            if (!address) return;

            fetch('/geocode', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ address: address })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert("Ошибка: " + data.error);
                    return;
                }

                // Центрируем карту на найденных координатах
                map.setCenter([data.lat, data.lon]);

                // Добавляем метку
                if (placemark) {
                    map.geoObjects.remove(placemark);
                }
                placemark = new ymaps.Placemark([data.lat, data.lon], {
                    hintContent: address,
                    balloonContent: `Адрес: ${address}<br>Координаты: ${data.lat}, ${data.lon}`
                });
                map.geoObjects.add(placemark);
            })
            .catch(error => {
                console.error("Ошибка:", error);
            });
        }
    </script>
</body>
</html>